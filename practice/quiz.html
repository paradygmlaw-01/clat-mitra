<!DOCTYPE html>
<html lang="hi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Legal Reasoning Quiz — CLAT Mitra</title>
  <style>
    :root {
      --primary:   #e65c00;
      --primary-d: #bf4a00;
      --accent:    #f9a825;
      --bg:        #fdfaf5;
      --surface:   #ffffff;
      --border:    #e8ddd0;
      --text:      #1a1a1a;
      --muted:     #6b6b6b;
      --correct:   #2e7d32;
      --wrong:     #c62828;
      --correct-bg:#e8f5e9;
      --wrong-bg:  #ffebee;
      --radius:    12px;
      --shadow:    0 2px 16px rgba(0,0,0,0.08);
    }
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: 'Segoe UI', system-ui, sans-serif;
      background: var(--bg); color: var(--text);
      min-height: 100vh; line-height: 1.6;
    }
    nav {
      background: var(--primary); color: #fff;
      padding: 0.75rem 1.5rem;
      display: flex; align-items: center; gap: 1rem;
      box-shadow: 0 2px 8px rgba(0,0,0,0.15);
    }
    nav a { color: #fff; text-decoration: none; font-size: 0.9rem; opacity: 0.85; }
    nav a:hover { opacity: 1; }
    nav .brand { font-weight: 700; font-size: 1.1rem; opacity: 1; margin-right: auto; }
    nav .sep { opacity: 0.4; }
    .page { max-width: 780px; margin: 0 auto; padding: 2rem 1rem 4rem; }
    .quiz-header { text-align: center; margin-bottom: 2rem; }
    .quiz-header h1 { font-size: 1.6rem; color: var(--primary); margin-bottom: 0.4rem; }
    .quiz-header p  { color: var(--muted); font-size: 0.95rem; }
    .filter-bar {
      display: flex; flex-wrap: wrap; gap: 0.5rem;
      justify-content: center; margin-bottom: 1.8rem;
    }
    .filter-btn {
      border: 2px solid var(--border); background: var(--surface);
      color: var(--muted); padding: 0.4rem 1rem; border-radius: 999px;
      cursor: pointer; font-size: 0.85rem; font-weight: 600; transition: all 0.2s;
    }
    .filter-btn:hover, .filter-btn.active {
      background: var(--primary); border-color: var(--primary); color: #fff;
    }
    .progress-wrap {
      background: var(--border); border-radius: 999px;
      height: 8px; margin-bottom: 0.5rem; overflow: hidden;
    }
    .progress-bar {
      height: 100%;
      background: linear-gradient(90deg, var(--primary), var(--accent));
      border-radius: 999px; transition: width 0.4s ease;
    }
    .progress-label { text-align: right; font-size: 0.8rem; color: var(--muted); margin-bottom: 1.5rem; }
    .q-card {
      background: var(--surface); border: 1px solid var(--border);
      border-radius: var(--radius); padding: 1.6rem;
      margin-bottom: 1.5rem; box-shadow: var(--shadow);
    }
    .q-meta { display: flex; gap: 0.5rem; flex-wrap: wrap; margin-bottom: 1rem; }
    .badge {
      font-size: 0.72rem; font-weight: 700; letter-spacing: 0.04em;
      padding: 0.2rem 0.6rem; border-radius: 999px;
      background: #fff3e0; color: var(--primary); border: 1px solid #ffe0b2;
    }
    .badge.topic { background: #e8eaf6; color: #3949ab; border-color: #c5cae9; }
    .principle-box, .facts-box {
      border-left: 3px solid var(--primary); background: #fff8f0;
      padding: 0.8rem 1rem; border-radius: 0 8px 8px 0;
      margin-bottom: 0.9rem; font-size: 0.9rem;
    }
    .facts-box { border-color: #f9a825; background: #fffde7; }
    .box-label {
      font-size: 0.72rem; font-weight: 700; letter-spacing: 0.06em;
      text-transform: uppercase; color: var(--muted); margin-bottom: 0.3rem;
    }
    .q-text { font-weight: 600; font-size: 1rem; margin: 1rem 0 0.8rem; }
    .options { display: flex; flex-direction: column; gap: 0.6rem; }
    .option-btn {
      text-align: left; background: var(--bg);
      border: 2px solid var(--border); border-radius: 8px;
      padding: 0.7rem 1rem; cursor: pointer; font-size: 0.92rem;
      transition: all 0.18s; color: var(--text);
    }
    .option-btn:hover:not(:disabled) { border-color: var(--primary); background: #fff3e0; }
    .option-btn.correct { border-color: var(--correct); background: var(--correct-bg); color: var(--correct); font-weight: 600; }
    .option-btn.wrong   { border-color: var(--wrong);   background: var(--wrong-bg);   color: var(--wrong); }
    .option-btn:disabled { cursor: default; }
    .explanation {
      display: none; margin-top: 1rem;
      background: #e8f5e9; border-left: 3px solid var(--correct);
      padding: 0.8rem 1rem; border-radius: 0 8px 8px 0;
      font-size: 0.88rem; color: #1b5e20;
    }
    .explanation.show { display: block; }
    .explanation strong { display: block; margin-bottom: 0.3rem; color: var(--correct); }
    #score-bar {
      display: none; background: var(--surface); border: 1px solid var(--border);
      border-radius: var(--radius); padding: 1.5rem 1.6rem; margin-bottom: 2rem;
      box-shadow: var(--shadow); text-align: center;
    }
    #score-bar h2    { font-size: 1.3rem; color: var(--primary); margin-bottom: 0.4rem; }
    .score-num       { font-size: 2.5rem; font-weight: 800; color: var(--primary); }
    .score-msg       { color: var(--muted); font-size: 0.9rem; margin-top: 0.3rem; }
    .restart-btn {
      margin-top: 1rem; background: var(--primary); color: #fff; border: none;
      padding: 0.6rem 1.6rem; border-radius: 999px; font-size: 0.95rem;
      font-weight: 700; cursor: pointer; transition: background 0.2s;
    }
    .restart-btn:hover { background: var(--primary-d); }

    /* EMPTY STATE */
    .empty-state {
      text-align: center; padding: 4rem 1rem;
      background: var(--surface); border: 1px solid var(--border);
      border-radius: var(--radius); box-shadow: var(--shadow);
    }
    .empty-state .es-emoji { font-size: 3rem; margin-bottom: 0.8rem; }
    .empty-state h3 { font-size: 1.2rem; font-weight: 700; color: var(--text); margin-bottom: 0.5rem; }
    .empty-state p  { font-size: 0.9rem; color: var(--muted); line-height: 1.7; }

    /* GLOSSARY */
    #glossary-section { margin-top: 3rem; }
    #glossary-section h2 { font-size: 1.3rem; color: var(--primary); margin-bottom: 0.3rem; }
    #glossary-section > p { color: var(--muted); font-size: 0.88rem; margin-bottom: 1rem; }
    .gloss-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: 0.8rem;
    }
    .gloss-card {
      background: var(--surface); border: 1px solid var(--border);
      border-radius: 10px; padding: 0.9rem 1rem;
      cursor: pointer; transition: box-shadow 0.18s, border-color 0.18s;
    }
    .gloss-card:hover { box-shadow: var(--shadow); border-color: var(--primary); }
    .gloss-term   { font-weight: 700; font-size: 0.95rem; color: var(--primary); margin-bottom: 0.15rem; }
    .gloss-subject{ font-size: 0.72rem; color: var(--muted); margin-bottom: 0.5rem; }
    .gloss-def    {
      font-size: 0.85rem; color: var(--text); display: none;
      border-top: 1px dashed var(--border); padding-top: 0.5rem; margin-top: 0.3rem;
    }
    .gloss-card.open .gloss-def { display: block; }
    .gloss-card.open { border-color: var(--primary); }

    /* AUTO-TOOLTIP */
    .gloss-tooltip {
      border-bottom: 2px dotted var(--primary); color: var(--primary);
      cursor: help; font-weight: 600; position: relative; display: inline;
    }
    .gloss-tooltip .tip-box {
      display: none; position: absolute;
      bottom: calc(100% + 6px); left: 50%; transform: translateX(-50%);
      background: #1a1a1a; color: #fff; padding: 0.5rem 0.8rem;
      border-radius: 8px; font-size: 0.78rem; font-weight: 400;
      width: 220px; z-index: 100; line-height: 1.4;
      box-shadow: 0 4px 16px rgba(0,0,0,0.25); pointer-events: none;
    }
    .gloss-tooltip .tip-box::after {
      content: ''; position: absolute; top: 100%; left: 50%;
      transform: translateX(-50%); border: 6px solid transparent;
      border-top-color: #1a1a1a;
    }
    .gloss-tooltip:hover .tip-box,
    .gloss-tooltip:focus .tip-box { display: block; }

    footer { text-align: center; font-size: 0.8rem; color: var(--muted); padding: 2rem 1rem 1rem; }

    @media (max-width: 540px) {
      .page { padding: 1rem 0.75rem 3rem; }
      .quiz-header h1 { font-size: 1.3rem; }
      .q-card { padding: 1.2rem; }
    }
  </style>
</head>
<body>

<nav>
  <a href="/clat-mitra/index.html" class="brand">&#9878;&#65039; CLAT Mitra</a>
  <span class="sep">&#8250;</span>
  <a href="/clat-mitra/index.html">Home</a>
  <span class="sep">&#8250;</span>
  <span>Quiz</span>
</nav>

<div class="page">

  <div class="quiz-header">
    <h1>&#9878;&#65039; Legal Reasoning Practice Quiz</h1>
    <p>Principle &#8594; Facts &#8594; सही Conclusion चुनो &nbsp;|&nbsp; किसी भी underlined term पर hover करो &#8212; definition दिखेगी!</p>
  </div>

  <!-- QUIZ FILTER -->
  <div class="filter-bar" id="filter-bar">
    <button class="filter-btn active" data-filter="all">&#128193; All</button>
    <button class="filter-btn" data-filter="Legal Reasoning Basics">&#9878;&#65039; Legal Reasoning</button>
    <button class="filter-btn" data-filter="Contract">&#128221; Contract</button>
    <button class="filter-btn" data-filter="Constitution">&#127963;&#65039; Constitution</button>
    <button class="filter-btn" data-filter="Torts">&#9888;&#65039; Torts</button>
    <button class="filter-btn" data-filter="Quantitative">&#128290; Quant</button>
    <button class="filter-btn" data-filter="Logical Reasoning">&#129504; Logical Reasoning</button>
    <button class="filter-btn" data-filter="GK">&#127758; GK</button>
    <button class="filter-btn" data-filter="English">&#128214; English</button>
  </div>

  <!-- SCORE BAR -->
  <div id="score-bar">
    <h2>&#127881; Quiz Complete!</h2>
    <div class="score-num" id="score-display">0 / 0</div>
    <div class="score-msg"  id="score-msg"></div>
    <button class="restart-btn" onclick="restartQuiz()">&#128260; फिर से करो</button>
  </div>

  <!-- PROGRESS -->
  <div class="progress-wrap"><div class="progress-bar" id="prog-bar" style="width:0%"></div></div>
  <div class="progress-label" id="prog-label">0 of 0 answered</div>

  <!-- QUESTIONS -->
  <div id="quiz-container"></div>

  <!-- GLOSSARY -->
  <div id="glossary-section">
    <h2>&#128218; Glossary</h2>
    <p>किसी भी term पर click करो &#8212; definition expand होगी।</p>
    <div class="filter-bar" id="gloss-filter-bar">
      <button class="filter-btn active" data-gfilter="all">All</button>
      <button class="filter-btn" data-gfilter="Legal Reasoning Basics">&#9878;&#65039; Legal Reasoning</button>
      <button class="filter-btn" data-gfilter="Contract">&#128221; Contract</button>
      <button class="filter-btn" data-gfilter="Constitution">&#127963;&#65039; Constitution</button>
      <button class="filter-btn" data-gfilter="Torts">&#9888;&#65039; Torts</button>
      <button class="filter-btn" data-gfilter="Quantitative">&#128290; Quant</button>
      <button class="filter-btn" data-gfilter="Logical Reasoning">&#129504; Logical Reasoning</button>
      <button class="filter-btn" data-gfilter="GK">&#127758; GK</button>
      <button class="filter-btn" data-gfilter="English">&#128214; English</button>
    </div>
    <div class="gloss-grid" id="gloss-grid"></div>
  </div>

</div><!-- /.page -->

<footer>CLAT Mitra &nbsp;&#183;&nbsp; बिल्कुल मुफ़्त &nbsp;&#183;&nbsp; कोई sign-up नहीं</footer>

<!-- ✅ FIXED: absolute path for GitHub Pages paradygmlaw-01.github.io/clat-mitra/ -->
<script src="/clat-mitra/questionBank.js"></script>

<script>
/* ─── STATE ─── */
var currentFilter  = "all";
var glossaryFilter = "all";
var answers  = {};
var filtered = [];

/* ─── HELPERS ─── */
function escHtml(str) {
  return String(str)
    .replace(/&/g, "&amp;")
    .replace(/</g, "&lt;")
    .replace(/>/g, "&gt;")
    .replace(/"/g, "&quot;");
}

/* ─── AUTO-TOOLTIP ENGINE ─── */
function buildTooltipHTML(text, glossaryArr) {
  var sorted = glossaryArr.slice().sort(function(a,b){ return b.term.length - a.term.length; });
  var result = escHtml(text);
  sorted.forEach(function(g) {
    var safe = g.term.replace(/[-.*+?^${}()|[\]\]/g, "\$&");
    var re   = new RegExp("(?<![\w>])(" + safe + ")(?![\w<])", "gi");
    var defSafe = escHtml(g.definition);
    result = result.replace(re,
      "<span class="gloss-tooltip" tabindex="0">$1<span class="tip-box">" + defSafe + "</span></span>"
    );
  });
  return result;
}

/* ─── RENDER QUIZ ─── */
function renderQuiz() {
  var db = window.questionBank;
  if (!db) {
    document.getElementById("quiz-container").innerHTML =
      "<div class='empty-state'><div class='es-emoji'>&#10060;</div><h3>questionBank.js load नहीं हुआ</h3><p>Check करो कि questionBank.js सही path पर है।</p></div>";
    return;
  }

  filtered = currentFilter === "all"
    ? db.questions
    : db.questions.filter(function(q){ return q.subject === currentFilter; });

  var container = document.getElementById("quiz-container");
  container.innerHTML = "";
  answers = {};
  updateProgress();
  document.getElementById("score-bar").style.display = "none";

  /* EMPTY STATE — Coming Soon */
  if (filtered.length === 0) {
    container.innerHTML =
      "<div class='empty-state'>" +
        "<div class='es-emoji'>&#128679;</div>" +
        "<h3>Coming Soon!</h3>" +
        "<p>इस subject के questions जल्द आएंगे।<br>अभी दूसरा subject try करो।</p>" +
      "</div>";
    document.getElementById("prog-label").textContent = "0 of 0 answered";
    document.getElementById("prog-bar").style.width = "0%";
    return;
  }

  filtered.forEach(function(q, idx) {
    var card = document.createElement("div");
    card.className = "q-card";
    card.id = "qcard-" + q.id;

    var optHTML = q.options.map(function(opt) {
      var letter = opt.trim().charAt(0);
      return "<button class='option-btn'" +
        " data-qid='" + q.id + "'" +
        " data-letter='" + letter + "'" +
        " onclick='chooseAnswer("" + q.id + "","" + letter + "")'>" +
        escHtml(opt) + "</button>";
    }).join("");

    card.innerHTML =
      "<div class='q-meta'>" +
        "<span class='badge'>"                                               + escHtml(q.subject) + "</span>" +
        "<span class='badge topic'>"                                         + escHtml(q.topic)   + "</span>" +
        "<span class='badge' style='background:#f3e5f5;color:#7b1fa2;border-color:#e1bee7;'>Q" + (idx+1) + "</span>" +
      "</div>" +
      "<div class='principle-box'><div class='box-label'>&#128220; Principle</div><div>" + buildTooltipHTML(q.principle, db.glossary) + "</div></div>" +
      "<div class='facts-box'><div class='box-label'>&#128203; Facts</div><div>"         + buildTooltipHTML(q.facts,     db.glossary) + "</div></div>" +
      "<div class='q-text'>" + escHtml(q.question) + "</div>" +
      "<div class='options' id='opts-" + q.id + "'>" + optHTML + "</div>" +
      "<div class='explanation' id='exp-" + q.id + "'><strong>&#9989; Explanation</strong>" + buildTooltipHTML(q.explanation, db.glossary) + "</div>";

    container.appendChild(card);
  });
}

/* ─── ANSWER HANDLER ─── */
function chooseAnswer(qid, letter) {
  if (answers[qid]) return;
  var q = window.questionBank.questions.filter(function(x){ return x.id === qid; })[0];
  answers[qid] = letter;

  var btns = document.querySelectorAll("#opts-" + qid + " .option-btn");
  btns.forEach(function(btn) {
    btn.disabled = true;
    var l = btn.getAttribute("data-letter");
    if (l === q.correctAnswer)                        btn.classList.add("correct");
    else if (l === letter && letter !== q.correctAnswer) btn.classList.add("wrong");
  });

  var exp = document.getElementById("exp-" + qid);
  if (exp) exp.classList.add("show");
  updateProgress();
  checkAllDone();
}

/* ─── PROGRESS ─── */
function updateProgress() {
  var total = filtered.length;
  var done  = Object.keys(answers).length;
  var pct   = total ? Math.round((done / total) * 100) : 0;
  document.getElementById("prog-bar").style.width  = pct + "%";
  document.getElementById("prog-label").textContent = done + " of " + total + " answered";
}

/* ─── SCORE ─── */
function checkAllDone() {
  if (!filtered.length || Object.keys(answers).length < filtered.length) return;
  var correct = filtered.filter(function(q){ return answers[q.id] === q.correctAnswer; }).length;
  var total   = filtered.length;
  var pct     = Math.round((correct / total) * 100);
  var bar     = document.getElementById("score-bar");
  bar.style.display = "block";
  bar.scrollIntoView({ behavior: "smooth", block: "start" });
  document.getElementById("score-display").textContent = correct + " / " + total;
  document.getElementById("score-msg").textContent =
    pct === 100 ? "&#127775; Perfect score! शानदार!" :
    pct >= 75   ? "&#128170; बहुत अच्छा! Almost there." :
    pct >= 50   ? "&#128218; ठीक है — explanations दोबारा पढ़ो।" :
                  "&#128260; फिर से try करो — concepts review करो।";
}

function restartQuiz() {
  renderQuiz();
  window.scrollTo({ top: 0, behavior: "smooth" });
}

/* ─── QUIZ FILTER ─── */
document.getElementById("filter-bar").addEventListener("click", function(e) {
  if (!e.target.matches(".filter-btn")) return;
  currentFilter = e.target.getAttribute("data-filter");
  document.querySelectorAll("#filter-bar .filter-btn").forEach(function(b){ b.classList.remove("active"); });
  e.target.classList.add("active");
  renderQuiz();
  window.scrollTo({ top: 0, behavior: "smooth" });
});

/* ─── RENDER GLOSSARY ─── */
function renderGlossary() {
  var db   = window.questionBank;
  var grid = document.getElementById("gloss-grid");
  grid.innerHTML = "";
  if (!db) return;

  var list = glossaryFilter === "all"
    ? db.glossary
    : db.glossary.filter(function(g){ return g.subject === glossaryFilter; });

  if (list.length === 0) {
    grid.innerHTML = "<p style='color:var(--muted);font-size:0.9rem;padding:1rem 0;'>इस subject की glossary जल्द आएगी।</p>";
    return;
  }

  list.forEach(function(g) {
    var card = document.createElement("div");
    card.className = "gloss-card";
    card.innerHTML =
      "<div class='gloss-term'>"    + escHtml(g.term)       + "</div>" +
      "<div class='gloss-subject'>" + escHtml(g.subject)    + "</div>" +
      "<div class='gloss-def'>"     + escHtml(g.definition) + "</div>";
    card.addEventListener("click", function(){ card.classList.toggle("open"); });
    grid.appendChild(card);
  });
}

/* ─── GLOSSARY FILTER ─── */
document.getElementById("gloss-filter-bar").addEventListener("click", function(e) {
  if (!e.target.matches(".filter-btn")) return;
  glossaryFilter = e.target.getAttribute("data-gfilter");
  document.querySelectorAll("#gloss-filter-bar .filter-btn").forEach(function(b){ b.classList.remove("active"); });
  e.target.classList.add("active");
  renderGlossary();
});

/* ─── INIT ─── */
window.addEventListener("DOMContentLoaded", function() {
  renderQuiz();
  renderGlossary();
});
</script>
</body>
</html>